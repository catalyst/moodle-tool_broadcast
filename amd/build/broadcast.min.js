define ("tool_broadcast/broadcast",["core/str","core/modal_factory","core/modal_events","core/ajax","core/fragment","core/notification"],function(a,b,c,d,e,f){var g={},h,i,j="<p class=\"text-center\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i></p>",k=function(){var a=document.getElementById("tool-broadcast-table-container"),b=a.getElementsByClassName("overlay-icon-container")[0],c=document.getElementById("tool-broadcast-table");b.classList.remove("hide");e.loadFragment("tool_broadcast","table",h).done(function(a){c.innerHTML=a;b.classList.add("hide");r()}).fail(function(){f.exception(new Error("Failed to update table."))})},l=function(b,c,d){if("undefined"==typeof b){b={}}if("undefined"==typeof c){c=0}if("undefined"==typeof d){d=""}var g={jsonformdata:JSON.stringify(b),broadcastid:c,action:d};a.get_string("broadcastdetails","tool_broadcast").then(function(a){i.setTitle(a);i.setBody(e.loadFragment("tool_broadcast","new_base_form",h,g))}).catch(function(){f.exception(new Error("Failed to load string: broadcastdetails"))})},m=function(a){a.preventDefault();var b=i.getRoot().find("form").serialize(),c=JSON.stringify(b),e=i.getRoot().find("[aria-invalid=\"true\"]"),f=i.getRoot().find(".error"),g;if(e.length){g=e.concat(f)}if(g!==void 0&&g.length){g.first().focus();return}d.call([{methodname:"tool_broadcast_submit_create_form",args:{jsonformdata:c}}])[0].done(function(){i.setBody(j);i.hide();k()}).fail(function(){l(b)})},n=function(){a.get_string("loading","tool_broadcast").then(function(a){b.create({type:b.types.DEFAULT,title:a,body:j,large:!0}).done(function(a){i=a;i.getRoot().on("click","#id_submitbutton",m);i.getRoot().on("click","#id_cancel",function(a){a.preventDefault();i.setBody(j);i.hide()})})}).catch(function(){f.exception(new Error("Failed to load string: loading"))})},o=function(){l();i.show()},p=function(a){a.preventDefault();var b=a.target.parentElement.id.substring(20);l({},b,"copy");i.show()},q=function(a){a.preventDefault();var b=a.target.parentElement.id.substring(20);l({},b,"edit");i.show()},r=function(){for(var a=document.getElementsByClassName("action-icon edit"),b=document.getElementsByClassName("action-icon copy"),c=0;c<a.length;c++){a[c].addEventListener("click",q)}for(var d=0;d<b.length;d++){b[d].addEventListener("click",p)}};g.init=function(a){h=a;n();r();var b=document.getElementById("local-broadcast-add-broadcast");b.addEventListener("click",o)};return g});
//# sourceMappingURL=broadcast.min.js.map
