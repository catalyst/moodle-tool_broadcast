define(["core/str","core/modal_factory","core/modal_events","core/ajax","core/fragment","core/notification"],function(a,b,c,d,e,f){var g,h,i={},j='<p class="text-center"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></p>',k=function(){var a=document.getElementById("tool-broadcast-table-container"),b=a.getElementsByClassName("overlay-icon-container")[0],c=document.getElementById("tool-broadcast-table");b.classList.remove("hide"),e.loadFragment("tool_broadcast","table",g).done(function(a){c.innerHTML=a,b.classList.add("hide"),r()}).fail(function(){f.exception(new Error("Failed to update table."))})},l=function(b,c,d){"undefined"==typeof b&&(b={}),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d="");var i={jsonformdata:JSON.stringify(b),broadcastid:c,action:d};a.get_string("broadcastdetails","tool_broadcast").then(function(a){h.setTitle(a),h.setBody(e.loadFragment("tool_broadcast","new_base_form",g,i))})["catch"](function(){f.exception(new Error("Failed to load string: broadcastdetails"))})},m=function(a){a.preventDefault();var b,c=h.getRoot().find("form").serialize(),e=JSON.stringify(c),f=h.getRoot().find('[aria-invalid="true"]'),g=h.getRoot().find(".error");return f.length&&(b=f.concat(g)),void 0!==b&&b.length?void b.first().focus():void d.call([{methodname:"tool_broadcast_submit_create_form",args:{jsonformdata:e}}])[0].done(function(){h.setBody(j),h.hide(),k()}).fail(function(){l(c)})},n=function(){a.get_string("loading","tool_broadcast").then(function(a){b.create({type:b.types.DEFAULT,title:a,body:j,large:!0}).done(function(a){h=a,h.getRoot().on("click","#id_submitbutton",m),h.getRoot().on("click","#id_cancel",function(a){a.preventDefault(),h.setBody(j),h.hide()})})})["catch"](function(){f.exception(new Error("Failed to load string: loading"))})},o=function(){l(),h.show()},p=function(a){a.preventDefault();var b=a.target.parentElement.id.substring(20);""!=b&&(l({},b,"copy"),h.show())},q=function(a){a.preventDefault();var b=a.target.parentElement.id.substring(20);""!=b&&(l({},b,"edit"),h.show())},r=function(){for(var a=document.getElementsByClassName("action-icon edit"),b=document.getElementsByClassName("action-icon copy"),c=0;c<a.length;c++)a[c].addEventListener("click",q);for(var c=0;c<b.length;c++)b[c].addEventListener("click",p)};return i.init=function(a){g=a,n(),r();var b=document.getElementById("local-broadcast-add-broadcast");b.addEventListener("click",o)},i});