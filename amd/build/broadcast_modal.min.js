define ("tool_broadcast/broadcast_modal",["core/str","core/modal_factory","core/modal_events","core/ajax","core/notification"],function(a,b,c,d,e){var f={},g,h,i="<p class=\"text-center\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i></p>",j={},k=function(){d.call([{methodname:"tool_broadcast_get_broadcasts",args:{contextid:g}}])[0].done(function(a){var b=JSON.parse(a);for(var c in b){var d=b[c].id;j[d]=b[c]}}).fail(function(){e.exception(new Error("Failed to get broadcast messages"))})},l=function(){d.call([{methodname:"tool_broadcast_check_broadcasts",args:{contextid:g}}],!0,!1)[0].done(function(a){var b=JSON.parse(a);if(b){k()}}).fail(function(){e.exception(new Error("Failed to get broadcast messages"))})},m=function(){if(!h.getRoot()[0].classList.contains("show")){for(var a in j){h.setTitle(j[a].title);h.setBody(j[a].body);h.footer[0].dataset.id=j[a].id;h.show();delete j[a];break}}},n=function(){h.setBody(i);var a=h.footer[0].dataset.id;d.call([{methodname:"tool_broadcast_acknowledge_broadcast",args:{contextid:g,broadcastid:a}}])[0].fail(function(){e.exception(new Error("Failed to acknowledge broadcast messages"))})},o=function(){return new Promise(function(d,e){a.get_string("loading","tool_broadcast").then(function(a){var e=document.createElement("input");e.type="button";e.value="Acknowledge";e.id="tool-broadcast-accept-broadcast";e.classList.add("btn","btn-primary","d-flex","ml-auto","mr-auto");b.create({type:b.types.DEFAULT,title:a,body:i,footer:e,large:!0}).done(function(a){h=a;h.getRoot().on("click","#tool-broadcast-accept-broadcast",function(a){a.preventDefault();h.hide()});h.getRoot().on(c.hidden,n);d()})}).catch(function(){e(new Error("Failed to load string: loading"))})})};f.init=function(a){g=a;var b=Math.floor(Math.random()*(2e4-10000+1))+10000;o().then(function(){l();setInterval(l,b);setInterval(m,5e3)}).catch(function(){e.exception(new Error("Failed to create broadcast modal"))})};return f});
//# sourceMappingURL=broadcast_modal.min.js.map
