define ("tool_broadcast/create_modal",["core/str","core/modal_factory","core/ajax","core/fragment","core/notification"],function(a,b,c,d,e){var f={},g,h,i="<p class=\"text-center\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i></p>",j=function(b){if("undefined"==typeof b){b={}}var c={jsonformdata:JSON.stringify(b)};a.get_string("broadcastdetails","tool_broadcast").then(function(a){h.setTitle(a);h.setBody(d.loadFragment("tool_broadcast","new_base_form",g,c))}).catch(function(){e.exception(new Error("Failed to load string: broadcastdetails"))})},k=function(a){a.preventDefault();var b=h.getRoot().find("form").serialize(),d=JSON.stringify(b),e=h.getRoot().find("[aria-invalid=\"true\"]"),f=h.getRoot().find(".error"),g=e.concat(f);if(g.length){g.first().focus();return}c.call([{methodname:"tool_broadcast_submit_create_form",args:{jsonformdata:d}}])[0].done(function(){h.setBody(i);h.hide()}).fail(function(){j(b)})},l=function(){a.get_string("loading","tool_broadcast").then(function(a){b.create({type:b.types.DEFAULT,title:a,body:i,large:!0}).done(function(a){h=a;h.getRoot().on("click","#id_submitreturn",k);h.getRoot().on("click","#id_submitdisplay",function(a){a.formredirect=!0;k(a)});h.getRoot().on("click","#id_cancel",function(a){a.preventDefault();h.setBody(i);h.hide()})})}).catch(function(){e.exception(new Error("Failed to load string: loading"))})},m=function(){j();h.show()};f.init=function(a){g=a;l();var b=document.getElementById("local-broadcast-add-broadcast");b.addEventListener("click",m)};return f});
//# sourceMappingURL=create_modal.min.js.map
