define ("tool_broadcast/create_modal",["core/str","core/modal_factory","core/modal_events","core/ajax","core/fragment","core/notification"],function(a,b,c,d,e,f){var g={},h,i,j="<p class=\"text-center\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i></p>",k=function(b){if("undefined"==typeof b){b={}}var c={jsonformdata:JSON.stringify(b)};a.get_string("broadcastdetails","tool_broadcast").then(function(a){i.setTitle(a);i.setBody(e.loadFragment("tool_broadcast","new_base_form",h,c))}).catch(function(){f.exception(new Error("Failed to load string: broadcastdetails"))})},l=function(a){a.preventDefault();var b=i.getRoot().find("form").serialize(),c=JSON.stringify(b),e=i.getRoot().find("[aria-invalid=\"true\"]"),f=i.getRoot().find(".error"),g;if(e.length){g=e.concat(f)}if(g!==void 0&&g.length){g.first().focus();return}d.call([{methodname:"tool_broadcast_submit_create_form",args:{jsonformdata:c}}])[0].done(function(){i.setBody(j);i.hide()}).fail(function(){k(b)})},m=function(){a.get_string("loading","tool_broadcast").then(function(a){b.create({type:b.types.DEFAULT,title:a,body:j,large:!0}).done(function(a){i=a;i.getRoot().on("click","#id_submitbutton",l);i.getRoot().on("click","#id_cancel",function(a){a.preventDefault();i.setBody(j);i.hide()})})}).catch(function(){f.exception(new Error("Failed to load string: loading"))})},n=function(){k();i.show()};g.init=function(a){h=a;m();var b=document.getElementById("local-broadcast-add-broadcast");b.addEventListener("click",n)};return g});
//# sourceMappingURL=create_modal.min.js.map
